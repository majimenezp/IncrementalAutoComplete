(function(a){a.widget("ui.inccombobox",{options:{pagesize:30,minLength:0,onSelect:null},container:null,input:null,lista:null,_create:function(){var b=this,f=this.element.hide(),e=f.children(":selected"),i=this.element[0].ownerDocument,h=e.val()?e.text():"",d=a("<input>").insertAfter(f).val(h).addClass("ui-autocomplete-input ui-widget ui-widget-content ui-corner-left").focusin(function(){this.select()}).bind("keydown.inccombobox",function(c){var d=a.ui.keyCode;switch(c.keyCode){case d.PAGE_UP:b._move("previousPage",c);break;case d.PAGE_DOWN:b._move("nextPage",c);break;case d.UP:b._move("previous1",c);c.preventDefault();break;case d.DOWN:b._move("next",c);c.preventDefault();break;case d.ENTER:b.active&&c.preventDefault();case d.TAB:if(!b.active)return;b.select();break;case d.ESCAPE:b.element.val(b.term);b.close(c);break;case d.SHIFT:case d.CONTROL:case 18:break;default:clearTimeout(b.searching);b.searching=setTimeout(function(){b.search(null,c)},b.options.delay)}}).bind("focus.inccombobox",function(){b.previous=b.element.val()}).bind("blur.inccombobox",function(){clearTimeout(b.searching)});this.input=d;d.selItem=function(a){return b._selectItem(a)};var c=a("<div></div>").addClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-autocomplete").css({top:0,left:0,height:200,width:200,"overflow-y":"auto","overflow-x":"hidden",margin:0}).attr({role:"listbox",id:this.id+"div"}).hide().appendTo("body",i);c[0].input=d;c[0].options=this.options;c[0].self=b;this.container=c;var g=a("<ul></ul>").appendTo(c).css({"list-style":"none","padding-left":0,"margin-top":0,"margin-left":0}).attr({role:"listbox",id:this.id+"ul","aria-activedescendant":"ui-active-menuitem"});this.lastpage=1;this.lastvalue="";this.pages=0;this.menu=g;c.hide();this._initSource();this.response=function(){return b._response.apply(b,arguments)};a("<button>&nbsp;</button>").attr("tabIndex",-1).attr("title","Show All Items").insertAfter(d).button({icons:{primary:"ui-icon-triangle-1-s"},text:false}).removeClass("ui-corner-all").addClass("ui-corner-right ui-button-icon").click(function(){if(c.is(":visible")){c.hide();return}b.search(d.val());c.show().position({my:"left top",at:"left bottom",of:d,collision:"none"})});c.scroll(function(){c[0].scrollTop+c.height()+4>=c[0].scrollHeight&&b._loadIncremental(d.val())})},search:function(a,b){a=a!=null?a:this.input.val();if(a.length<this.options.minLength)return this.close(b);clearTimeout(this.closing);return this._trigger("search")===false?void 0:this._search(a)},_search:function(a){this.term=this.element.addClass("ui-autocomplete-loading").val();if(this.lastvalue!=a||a==""){this.lastvalue=a;this.lastpage=1;this.source({search:a,pagesize:this.options.pagesize,page:this.lastpage},this.response)}},_loadIncremental:function(a){if(this.lastpage>=this.pages)return;if(this.lastvalue==a)this.lastpage+=1;else this.lastpage=1;this.source({search:a,pagesize:this.options.pagesize,page:this.lastpage},this.response)},_initSource:function(){var b,c;if(a.isArray(this.options.source)){b=this.options.source;this.source=function(e,c){var d=new RegExp(a.ui.autocomplete.escapeRegex(e.term),"i");c(a.grep(b,function(a){return d.test(a.label||a.value||a)}))}}else if(typeof this.options.source==="string"){c=this.options.source;this.source=function(d,b){a.getJSON(c,d,b)}}else this.source=this.options.source},_response:function(a){this.pages=a.pages;if(a.results.length){var b=this._normalize(a.results);a.page==1&&this.menu.children().remove();this._suggest(b);this.open()}else this.close()},close:function(a){clearTimeout(this.closing);if(this.menu.is(":visible")){this._trigger("close",a);this.container.hide()}this.previous!==this.element.val()&&this._trigger("change",a)},open:function(){this.container.show().position({my:"left top",at:"left bottom",of:this.input,collision:"none"})},_normalize:function(b){return b.length&&b[0].label&&b[0].value?b:a.map(b,function(b){return typeof b==="string"?{label:b,value:b}:a.extend({label:b.label||b.value,value:b.value||b.label},b)})},_suggest:function(a){var b=this.menu;this._renderMenu(b,a)},_selectItem:function(b){var c=a(b).parent().parent()[0],e=b.text(),d=a(b).attr("value");this.element.val(d);this.input.val(e);if(typeof c.options.onSelect==="function")c.options.onSelect(this,{label:e,value:d});a(c).hide()},_onItemClick:function(){a(this).parent().parent()[0].input.selItem(a(this))},select:function(){this._selectItem(this.active)},_move:function(a,b){if(!this.container.is(":visible")){this.search(null,b);return}this[a]()},_renderMenu:function(d,b){var c=this;a.each(b,function(b,a){c._renderItem(d,a)})},_renderItem:function(c,b){return a("<li></li>").attr({value:b.value}).data("item.autocomplete ui-corner-all",b).addClass("ui-menu-item").append("<a>"+b.label+"</a>").appendTo(c).mouseenter(function(){a(this).parent().parent()[0].self.activate(a(this))}).mouseleave(function(){a(this).parent().parent()[0].self.deactivate()}).click(this._onItemClick);this.input.append(a("<option></option>").attr("value",b.value).text(b.label))},activate:function(c){this.deactivate();var e="";if(this.hasScroll()){var a=c.offset().top-this.container.offset().top,b=this.container.attr("scrollTop"),d=this.container.height();if(a<0){e=b+a;this.container.attr("scrollTop",b+a)}else if(a>d){e=b+a-d+c.height();this.container.attr("scrollTop",b+a-d+c.height())}}this.active=c.eq(0).children("a").addClass("ui-state-hover").attr("id","ui-active-menuitem").end()},hasScroll:function(){return this.container.height()<this.container.attr("scrollHeight")},deactivate:function(){if(!this.active)return;this.active.children("a").removeClass("ui-state-hover").removeAttr("id");this._trigger("blur");this.active=null},previous1:function(){this.move("prev","li:last")},next:function(){this.move("next","li:first")},move:function(c,a){if(!this.active){this.activate(this.menu.children(a));return}var b=this.active[c]();if(b.length)this.activate(b);else this.activate(this.menu.children(a))}})})(jQuery)